{% assign translated_url = "" %}

{% if page.lang_ref %}
  {% for p in site.pages %}
    {% if p.lang_ref == page.lang_ref and p.lang != page.lang %}
      {% assign translated_url = p.url | relative_url %}
    {% endif %}
  {% endfor %}
{% endif %}

<script>
document.addEventListener("DOMContentLoaded", function() {

  // --- PDF ve Dış Link Ayarları (Standart) ---
  var links = document.links;
  for (var i = 0; i < links.length; i++) {
    if (links[i].hostname != window.location.hostname) {
      links[i].target = '_blank';
      links[i].rel = 'noopener noreferrer';
    } else if (links[i].href.endsWith(".pdf")) {
      links[i].target = '_blank';
    }
  }

  // --- HİBRİT LİNK REWRITER ---
  
  // Liquid tarafından bulunan URL'i JS değişkenine aktar
  var smartUrl = "{{ translated_url }}"; 
  var currentLang = "{{ page.lang }}"; // 'tr' veya 'en'

  // Eğer Liquid bir eşleşme bulduysa (lang_ref çalıştıysa)
  if (smartUrl !== "") {
    
    // TR sayfasındaysak -> İngilizce butonunu bu özel linke ayarla
    if (currentLang === 'tr') {
      var enBtn = document.querySelector('a[href="/en/"]');
      if (enBtn) enBtn.setAttribute('href', smartUrl);
    } 
    // EN sayfasındaysak -> Türkçe butonunu bu özel linke ayarla
    else if (currentLang === 'en') {
      var trBtn = document.querySelector('a[href="/tr/"]');
      if (trBtn) trBtn.setAttribute('href', smartUrl);
    }
  
  } else {
    // EŞLEŞME YOKSA: Eski "Ayna Kuralı"nı (Fallback) uygula
    // (Böylece lang_ref yazmayı unutsan bile sistem çökmez, tahmin etmeye çalışır)
    
    var currentPath = window.location.pathname;
    
    if (currentLang === 'tr') {
      var enBtn = document.querySelector('a[href="/en/"]');
      if (enBtn) {
        var newPath = currentPath.replace('/tr/', '/en/');
        enBtn.setAttribute('href', newPath);
      }
    } else {
      var trBtn = document.querySelector('a[href="/tr/"]');
      if (trBtn) {
        var newPath = currentPath.replace('/en/', '/tr/');
        trBtn.setAttribute('href', newPath);
      }
    }
  }

});
</script>